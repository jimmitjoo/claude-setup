#!/usr/bin/expect -f
#
# Wrapper för Claude Code som automatiskt fortsätter vid timeout-prompts
#
# Användning: claude-auto [vanliga claude argument]
#
# Installera expect först:
#   Ubuntu/Debian: sudo apt install expect
#   macOS: brew install expect
#

set timeout -1

# Starta claude med alla argument
spawn claude {*}$argv

# Loop för att hantera prompts
expect {
    # Plan mode prompt - godkänn automatiskt
    -re {(?i)plan mode|enter plan mode|planläge|vill du gå in i plan} {
        send "y\r"
        exp_continue
    }

    # Exit plan mode / approve plan
    -re {(?i)approve|godkänn|exit plan|avsluta plan|proceed|fortsätt med plan} {
        send "y\r"
        exp_continue
    }

    # Vanliga fortsätt-prompts
    -re {(?i)continue\?|fortsätt\?|keep going\?|vill du fortsätta} {
        send "y\r"
        exp_continue
    }

    # Timeout-varning
    -re {(?i)still working|fortfarande} {
        send "y\r"
        exp_continue
    }

    # Generell [y/n] prompt - auto-confirm
    -re {\[y/n\]} {
        send "y\r"
        exp_continue
    }

    # Yes/No prompt
    -re {(?i)\(yes/no\)|\(y/n\)} {
        send "yes\r"
        exp_continue
    }

    # Permission prompts
    -re {(?i)allow|tillåt|permission} {
        send "y\r"
        exp_continue
    }

    # Vänta på mer output
    eof {
        # Claude avslutade
    }
}
